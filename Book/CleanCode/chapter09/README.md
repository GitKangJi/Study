# 9장 단위 테스트

&nbsp;애자일과 TDD 등등 새로운 프로그래밍 기술들은 계속 나오고 발전한다. 그리고 우리는 꾸준히 공부해야 한다.

## TDD 법칙 세 가지

&nbsp;다음은 TDD의 세 가지 법칙이다.

- 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
- 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
- 현재 실패하는 테스트틀 통과할 정도로만 실제 코드를 작성한다.

이렇게 작업하면 많은 테스트 케이스가 나오고, 실제 코드를 전부 테스트하는 코드가 된다. 하지만 너무 많은 테스트도 관리 문제를 유발하기도 한다.

## 깨끗한 테스트 코드 유지하기

&nbsp;지저분한 테스트는 테스트를 안하는 것 보다 더 못하다. 코드가 변경되려면 테스트코드도 변경돼야 하지만, 테스트 코드가 더러우면 실제 코드를 변경하는 시간보다 테스트 코드에 소비하는 시간이 더 많아진다. 하지만 테스트 코드가 없으면 자신이 수정한 코드가 잘 작동하는지 알 수 없다.

> 테스트 코드는 실제 코드 못지 않게 중요하다.

### 테스트는 유연성, 유지보수성, 재사용성을 재공한다.

&nbsp;단위 테스트는 코드의 `유연성`, `유지보수성`, `재사용성`을 제공한다. 테스트 케이스가 있으면 변경이 쉬워진다.

## 깨끗한 테스트 코드

&nbsp;깨끗한 테스트 코드를 위해서는 가독성이 가장 중요하다. 또한 가독성을 위해서는 명료성, 단순성, 풍부한 표현력이 필요하다.

> 테스트 코드는 최소한의 표현으로 많은 것을 나타내야 한다.

테스트와 무관한 코드는 함수로 추출하고, 잡음을 없애야 한다. 진짜 필요한 자료 유형과 함수만 사용해야 한다.

실제 환경에서는 안 되지만 테스트 환경에서는 문제없는 방식이 있다. 이것을 이중 표준이라 한다. 하지만 이 또한 테스트 코드의 깨끗함과는 무관하기 때문에 깨끗한 코드를 잘 작성해야 한다.

## 테스트 당 assert 하나

&nbsp;테스트 코드를 작성할 때 하나의 함수에 하나의 `assert`가 있는게 좋다. 그리고 `given-when-then` 관례를 사용하면 테스트 코드를 읽기도 쉬워진다. 하지만 테스트를 여러 함수로 분리하면 중복되는 코드가 생긴다. 중복된 코드는 `Template Method`패턴을 사용해서 해결할 수 있다.

물론 디자인 패턴을 이용해서 해결할 수 있지만, 배보다 배꼽이 더 커지는 경우가 많다. 따라서 단일 assert문은 좋은 생각이지만 여러 assert문도 상황에 맞게 사용해야 한다.

`테스트 당 assert 하나` 규칙보다는 `테스트 당 개념 하나` 규칙이 더 낫다. 독자적 개념은 분리해야 한다.

## F.I.R.S.T

&nbsp;다음은 깨끗한 테스트의 다섯 가지 규칙이다.

- Fast: 테스트는 빨라야 한다.
- Independent: 각 테스트는 서로 의존하면 안 된다.
- Repeatable: 테스트는 어떤 환경에서도 반복 가능해야 한다.
- Self-Validating: 테스트는 Bool 값으로 결과를 내야 한다.
- Timely: 테스트는 적시에 작성해야 한다.

## 결론

&nbsp;테스트 코드는 지속적으로 깨끗하게 관리해야 한다.
